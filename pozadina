<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maki Bend — Kontakt / Booking</title>
  <style>
    :root{
      --accent:#e63946;
      --bg-overlay: rgba(0,0,0,0.65);
      --card-bg: rgba(0,0,0,0.55);
      --text:#fff;
      --radius:10px;
      --maxw:920px;
    }
    *{box-sizing:border-box}
    body,html{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;color:var(--text)}
    /* Pozadina (zameni putanju ako hoćeš drugu sliku) */
    body{
      background-image: url('images/pozadina.jpg');
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
    }
    .overlay{
      position:fixed;inset:0;background:var(--bg-overlay);z-index:0;
    }
    .wrap{
      position:relative;z-index:10;max-width:var(--maxw);margin:40px auto;padding:28px;border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.65));
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
    }
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{
      width:72px;height:72px;border-radius:8px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px
    }
    h1{font-size:28px;margin:0}
    p.lead{margin:8px 0 20px;color:#ddd}
    form{display:grid;grid-template-columns:1fr 360px;gap:20px}
    @media(max-width:880px){form{grid-template-columns:1fr}}
    .card{background:var(--card-bg);padding:18px;border-radius:10px}
    label{display:block;font-weight:600;margin-bottom:6px;font-size:0.95rem}
    input[type="text"], input[type="email"], input[type="tel"], textarea, select{
      width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:var(--text);outline:none;
    }
    textarea{min-height:120px;resize:vertical}
    .field{margin-bottom:14px}
    .small{font-size:0.85rem;color:#cfcfcf}
    .images-preview{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .thumb{width:80px;height:80px;border-radius:6px;object-fit:cover;border:2px solid rgba(255,255,255,0.08)}
    .btn{
      display:inline-block;background:var(--accent);color:white;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700;
    }
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.12)}
    .meta{font-size:0.9rem;color:#ddd;margin-top:8px}
    .status{margin-top:12px;font-weight:600}
    footer{margin-top:18px;color:#bbb;font-size:0.9rem;text-align:center}
  </style>
</head>
<body>
  <div class="overlay"></div>

  <main class="wrap" role="main">
    <header>
      <div class="logo">MB</div>
      <div>
        <h1>Maki Bend — Kontakt / Booking</h1>
        <p class="lead">Pošaljite nam poruku za booking, saradnju ili pitanja. Uključite slike benda i kontakt glavnog muzičara.</p>
      </div>
    </header>

    <form id="contactForm" class="card" autocomplete="off">
      <!-- LEVA KOLONA: Podaci benda i poruka -->
      <div>
        <div class="field">
          <label for="bandName">Naziv benda</label>
          <input id="bandName" name="bandName" type="text" placeholder="Maki Bend" required />
        </div>

        <div class="field">
          <label for="senderName">Vaše ime</label>
          <input id="senderName" name="senderName" type="text" placeholder="Ime i prezime" required />
        </div>

        <div class="field">
          <label for="senderEmail">Vaš mejl</label>
          <input id="senderEmail" name="senderEmail" type="email" placeholder="ime@primjer.com" required />
        </div>

        <div class="field">
          <label for="message">Poruka</label>
          <textarea id="message" name="message" placeholder="Napišite poruku..." required></textarea>
        </div>

        <div class="field">
          <label for="images">Slike benda (možete više)</label>
          <input id="images" name="images" type="file" accept="image/*" multiple />
          <div class="images-preview" id="previews"></div>
          <div class="small">Preporučena veličina: do 2MB po slici. Slike će se privremeno kodirati u Base64 i poslati u JSON.</div>
        </div>

        <div class="meta">Napomena: za slanje fajlova potreban je backend koji prihvata Base64 u JSON ili multipart/form-data. Ako nemaš backend, možeš preuzeti .json fajl sa sadržajem forme.</div>
      </div>

      <!-- DESNA KOLONA: Podaci glavnog muzičara i kontrola -->
      <aside>
        <div class="card" style="background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.55))">
          <div class="field">
            <label for="leadName">Glavni muzičar (ime)</label>
            <input id="leadName" name="leadName" type="text" placeholder="Ime glavnog muzičara" required />
          </div>

          <div class="field">
            <label for="leadPhone">Telefon glavnog muzičara</label>
            <input id="leadPhone" name="leadPhone" type="tel" placeholder="+3816xxxxxxxx" required />
            <div class="small">Unesite broj sa međunarodnim pozivnim ili lokalnim formatom.</div>
          </div>

          <div class="field">
            <label for="location">Lokacija (grad / država)</label>
            <input id="location" name="location" type="text" placeholder="Beograd, Srbija" required />
          </div>

          <div style="display:flex;gap:10px;margin-top:6px">
            <button type="button" id="sendBtn" class="btn">Pošalji poruku</button>
            <button type="button" id="downloadBtn" class="btn secondary">Preuzmi .json</button>
          </div>

          <div class="status" id="status"></div>
        </div>
      </aside>
    </form>

    <footer>© Maki Bend • Kontakt forma — napravljeno za tvoj sajt</footer>
  </main>

  <script>
    /*******************************************************
     * CONFIG:
     * Postavi svoj endpoint u FORM_ENDPOINT varijablu.
     * Primer: "https://example.com/api/booking" ili endpoint servisa poput Formspree.
     * Ako ostaviš prazan string, neće pokušati da pošalje POST — moći ćeš da preuzmeš .json.
     *******************************************************/
    const FORM_ENDPOINT = ""; // <-- OVDE: stavi svoj URL za POST ako imaš backend

    /* Elementi */
    const imagesInput = document.getElementById('images');
    const previews = document.getElementById('previews');
    const sendBtn = document.getElementById('sendBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const statusEl = document.getElementById('status');
    const form = document.getElementById('contactForm');

    let selectedFiles = [];

    /* Prikaz preview-a i čuvanje File objekata */
    imagesInput.addEventListener('change', (e) => {
      previews.innerHTML = '';
      selectedFiles = Array.from(e.target.files).slice(0, 8); // limit na 8 fajlova
      selectedFiles.forEach(file => {
        const img = document.createElement('img');
        img.className = 'thumb';
        img.alt = file.name;
        // brzo preview
        const reader = new FileReader();
        reader.onload = () => img.src = reader.result;
        reader.readAsDataURL(file);
        previews.appendChild(img);
      });
    });

    /* Pomoćna: konvertuj File u Base64 (DataURL) */
    function fileToDataURL(file){
      return new Promise((res, rej) => {
        const reader = new FileReader();
        reader.onload = () => res(reader.result);
        reader.onerror = () => rej('Error reading file');
        reader.readAsDataURL(file);
      });
    }

    /* Prikupljanje podataka iz forme u objekt */
    async function collectFormData(){
      const data = {
        timestamp: new Date().toISOString(),
        bandName: form.bandName.value.trim(),
        senderName: form.senderName.value.trim(),
        senderEmail: form.senderEmail.value.trim(),
        message: form.message.value.trim(),
        leadName: form.leadName.value.trim(),
        leadPhone: form.leadPhone.value.trim(),
        location: form.location.value.trim(),
        images: []
      };

      // validacija telefona (jednostavna)
      if(!/[\d+]/.test(data.leadPhone)) throw 'Neispravan broj telefona';

      // kodiranje slika u base64 (ako postoje)
      for(const f of selectedFiles){
        // ograničenje veličine (npr. 4MB)
        if(f.size > 4 * 1024 * 1024) {
          throw `Fajl ${f.name} je veći od 4MB (skini ili optimizuj sliku).`;
        }
        const d = await fileToDataURL(f);
        data.images.push({ name: f.name, type: f.type, dataURL: d });
      }

      return data;
    }

    /* Funkcija za slanje POST JSON */
    async function sendDataToEndpoint(jsonData){
      if(!FORM_ENDPOINT) throw 'Nijedan endpoint nije konfigurisan (FORM_ENDPOINT je prazan).';
      const res = await fetch(FORM_ENDPOINT, {
        method:'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(jsonData)
      });
      if(!res.ok) {
        const text = await res.text().catch(()=>res.statusText);
        throw `Server returned ${res.status}: ${text}`;
      }
      return res;
    }

    /* Preuzimanje JSON fajla lokalno */
    function downloadJSON(data){
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${data.bandName || 'maki-bend'}-poruka-${new Date().toISOString().slice(0,19).replaceAll(':','-')}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    /* Glavni handler za slanje */
    sendBtn.addEventListener('click', async () => {
      statusEl.textContent = 'Priprema podataka...';
      try {
        const payload = await collectFormData();
        statusEl.textContent = 'Šaljem...';

        if(FORM_ENDPOINT){
          await sendDataToEndpoint(payload);
          statusEl.textContent = 'Poruka uspešno poslata! Hvala.';
        } else {
          statusEl.textContent = 'Nema podešenog endpointa — preuzmi .json ili podesi backend.';
          downloadJSON(payload);
        }
      } catch(err){
        statusEl.textContent = 'Greška: ' + (err.message || err);
      }
      setTimeout(()=>statusEl.textContent = '', 7000);
    });

    /* Download button - uvek preuzme JSON, bez slanja */
    downloadBtn.addEventListener('click', async () => {
      statusEl.textContent = 'Priprema .json fajla...';
      try{
        const payload = await collectFormData();
        downloadJSON(payload);
        statusEl.textContent = 'Fajl preuzet.';
      }catch(err){
        statusEl.textContent = 'Greška: ' + (err.message || err);
      }
      setTimeout(()=>statusEl.textContent = '', 5000);
    });

    /* Prevent default submit (form nije regularno submit-ovana) */
    form.addEventListener('submit', (e) => e.preventDefault());
  </script>
</body>
</html>
